require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _ = require('../..');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

require('mochawait');

var _helpers = require('./helpers');

var should = _chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('exec', function () {
  it('should work with arguments like spawn', function callee$1$0() {
    var cmd, args, _ref, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = 'ls';
          args = [__dirname];
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap((0, _.exec)(cmd, args));

        case 4:
          _ref = context$2$0.sent;
          stdout = _ref.stdout;
          stderr = _ref.stderr;
          code = _ref.code;

          stdout.should.contain("exec-specs.js");
          stderr.should.equal("");
          code.should.equal(0);

        case 11:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should throw an error with a bad exit code', function callee$1$0() {
    var cmd, err;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("bad_exit.sh");
          err = undefined;
          context$2$0.prev = 2;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _.exec)(cmd));

        case 5:
          context$2$0.next = 10;
          break;

        case 7:
          context$2$0.prev = 7;
          context$2$0.t0 = context$2$0['catch'](2);

          err = context$2$0.t0;

        case 10:
          should.exist(err);
          err.stdout.trim().should.equal("foo");
          err.stderr.trim().should.equal("bar");
          err.code.should.equal(1);

        case 14:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this, [[2, 7]]);
  });

  it('should work with spaces in arguments', function callee$1$0() {
    var cmd, echo1, echo2, _ref2, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo.sh");
          echo1 = "my name is bob";
          echo2 = "lol";
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _.exec)(cmd, [echo1, echo2]));

        case 5:
          _ref2 = context$2$0.sent;
          stdout = _ref2.stdout;
          stderr = _ref2.stderr;
          code = _ref2.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should work with backslashes in arguments', function callee$1$0() {
    var cmd, echo1, echo2, _ref3, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo.sh");
          echo1 = "my\\ name\\ is\\ bob";
          echo2 = "lol";
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _.exec)(cmd, [echo1, echo2]));

        case 5:
          _ref3 = context$2$0.sent;
          stdout = _ref3.stdout;
          stderr = _ref3.stderr;
          code = _ref3.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should work with spaces in commands', function callee$1$0() {
    var cmd, echo1, echo2, _ref4, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo with space.sh");
          echo1 = "my name is bob";
          echo2 = "lol";
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap((0, _.exec)(cmd, [echo1, echo2]));

        case 5:
          _ref4 = context$2$0.sent;
          stdout = _ref4.stdout;
          stderr = _ref4.stderr;
          code = _ref4.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should respect cwd', function callee$1$0() {
    var cmd, echo1, echo2, cwd, _ref5, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = "./echo.sh";
          echo1 = "my name is bob";
          echo2 = "lol";
          cwd = _path2['default'].dirname((0, _helpers.getFixture)("echo.sh"));
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap((0, _.exec)(cmd, [echo1, echo2], { cwd: cwd }));

        case 6:
          _ref5 = context$2$0.sent;
          stdout = _ref5.stdout;
          stderr = _ref5.stderr;
          code = _ref5.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 13:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should respect env', function callee$1$0() {
    var cmd, env, _ref6, stdout, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("env.sh");
          env = { FOO: "lolol" };
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap((0, _.exec)(cmd, [], { env: env }));

        case 4:
          _ref6 = context$2$0.sent;
          stdout = _ref6.stdout;
          code = _ref6.code;

          stdout.trim().should.equal(env.FOO + ' ' + env.FOO);
          code.should.equal(0);

        case 9:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should allow a timeout parameter', function callee$1$0() {
    var cmd, args, err;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = "sleep";
          args = ["10"];
          err = undefined;
          context$2$0.prev = 3;
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap((0, _.exec)(cmd, args, { timeout: 500 }));

        case 6:
          context$2$0.next = 11;
          break;

        case 8:
          context$2$0.prev = 8;
          context$2$0.t0 = context$2$0['catch'](3);

          err = context$2$0.t0;

        case 11:
          should.exist(err);
          err.message.should.contain("timed out");
          err.message.should.contain(cmd);

        case 14:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this, [[3, 8]]);
  });

  it('should allow large amounts of output', function callee$1$0() {
    var _ref7, stdout;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _.exec)((0, _helpers.getFixture)("bigbuffer.js")));

        case 2:
          _ref7 = context$2$0.sent;
          stdout = _ref7.stdout;

          stdout.length.should.be.above(512 * 1024);

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should ignore output if requested', function callee$1$0() {
    var cmd, echo1, _ref8, stdout, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = (0, _helpers.getFixture)("echo.sh");
          echo1 = "my name is bob";
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap((0, _.exec)(cmd, [echo1], { ignoreOutput: true }));

        case 4:
          _ref8 = context$2$0.sent;
          stdout = _ref8.stdout;
          code = _ref8.code;

          stdout.should.equal("");
          code.should.equal(0);

        case 9:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});
//# sourceMappingURL=data:application/json;base64,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QUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0dBQ3RCLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2V4ZWMtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgJ21vY2hhd2FpdCc7XG5pbXBvcnQgeyBnZXRGaXh0dXJlIH0gZnJvbSAnLi9oZWxwZXJzJztcblxuY29uc3Qgc2hvdWxkID0gY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ2V4ZWMnLCAoKSA9PiB7XG4gIGl0KCdzaG91bGQgd29yayB3aXRoIGFyZ3VtZW50cyBsaWtlIHNwYXduJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbWQgPSAnbHMnO1xuICAgIGxldCBhcmdzID0gW19fZGlybmFtZV07XG4gICAgbGV0IHtzdGRvdXQsIHN0ZGVyciwgY29kZX0gPSBhd2FpdCBleGVjKGNtZCwgYXJncyk7XG4gICAgc3Rkb3V0LnNob3VsZC5jb250YWluKFwiZXhlYy1zcGVjcy5qc1wiKTtcbiAgICBzdGRlcnIuc2hvdWxkLmVxdWFsKFwiXCIpO1xuICAgIGNvZGUuc2hvdWxkLmVxdWFsKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIHdpdGggYSBiYWQgZXhpdCBjb2RlJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiYmFkX2V4aXQuc2hcIik7XG4gICAgbGV0IGVycjtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYyhjbWQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGVyciA9IGU7XG4gICAgfVxuICAgIHNob3VsZC5leGlzdChlcnIpO1xuICAgIGVyci5zdGRvdXQudHJpbSgpLnNob3VsZC5lcXVhbChcImZvb1wiKTtcbiAgICBlcnIuc3RkZXJyLnRyaW0oKS5zaG91bGQuZXF1YWwoXCJiYXJcIik7XG4gICAgZXJyLmNvZGUuc2hvdWxkLmVxdWFsKDEpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBzcGFjZXMgaW4gYXJndW1lbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZWNoby5zaFwiKTtcbiAgICBsZXQgZWNobzEgPSBcIm15IG5hbWUgaXMgYm9iXCI7XG4gICAgbGV0IGVjaG8yID0gXCJsb2xcIjtcbiAgICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoY21kLCBbZWNobzEsIGVjaG8yXSk7XG4gICAgc3Rkb3V0LnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzEpO1xuICAgIHN0ZGVyci50cmltKCkuc2hvdWxkLmVxdWFsKGVjaG8yKTtcbiAgICBjb2RlLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggYmFja3NsYXNoZXMgaW4gYXJndW1lbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZWNoby5zaFwiKTtcbiAgICBsZXQgZWNobzEgPSBcIm15XFxcXCBuYW1lXFxcXCBpc1xcXFwgYm9iXCI7XG4gICAgbGV0IGVjaG8yID0gXCJsb2xcIjtcbiAgICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoY21kLCBbZWNobzEsIGVjaG8yXSk7XG4gICAgc3Rkb3V0LnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzEpO1xuICAgIHN0ZGVyci50cmltKCkuc2hvdWxkLmVxdWFsKGVjaG8yKTtcbiAgICBjb2RlLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggc3BhY2VzIGluIGNvbW1hbmRzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZWNobyB3aXRoIHNwYWNlLnNoXCIpO1xuICAgIGxldCBlY2hvMSA9IFwibXkgbmFtZSBpcyBib2JcIjtcbiAgICBsZXQgZWNobzIgPSBcImxvbFwiO1xuICAgIGxldCB7c3Rkb3V0LCBzdGRlcnIsIGNvZGV9ID0gYXdhaXQgZXhlYyhjbWQsIFtlY2hvMSwgZWNobzJdKTtcbiAgICBzdGRvdXQudHJpbSgpLnNob3VsZC5lcXVhbChlY2hvMSk7XG4gICAgc3RkZXJyLnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzIpO1xuICAgIGNvZGUuc2hvdWxkLmVxdWFsKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlc3BlY3QgY3dkJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbWQgPSBcIi4vZWNoby5zaFwiO1xuICAgIGxldCBlY2hvMSA9IFwibXkgbmFtZSBpcyBib2JcIjtcbiAgICBsZXQgZWNobzIgPSBcImxvbFwiO1xuICAgIGxldCBjd2QgPSBwYXRoLmRpcm5hbWUoZ2V0Rml4dHVyZShcImVjaG8uc2hcIikpO1xuICAgIGxldCB7c3Rkb3V0LCBzdGRlcnIsIGNvZGV9ID0gYXdhaXQgZXhlYyhjbWQsIFtlY2hvMSwgZWNobzJdLCB7Y3dkfSk7XG4gICAgc3Rkb3V0LnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzEpO1xuICAgIHN0ZGVyci50cmltKCkuc2hvdWxkLmVxdWFsKGVjaG8yKTtcbiAgICBjb2RlLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZXNwZWN0IGVudicsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgY21kID0gZ2V0Rml4dHVyZShcImVudi5zaFwiKTtcbiAgICBsZXQgZW52ID0ge0ZPTzogXCJsb2xvbFwifTtcbiAgICBsZXQge3N0ZG91dCwgY29kZX0gPSBhd2FpdCBleGVjKGNtZCwgW10sIHtlbnZ9KTtcbiAgICBzdGRvdXQudHJpbSgpLnNob3VsZC5lcXVhbChgJHtlbnYuRk9PfSAke2Vudi5GT099YCk7XG4gICAgY29kZS5zaG91bGQuZXF1YWwoMCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYWxsb3cgYSB0aW1lb3V0IHBhcmFtZXRlcicsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgY21kID0gXCJzbGVlcFwiO1xuICAgIGxldCBhcmdzID0gW1wiMTBcIl07XG4gICAgbGV0IGVycjtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYyhjbWQsIGFyZ3MsIHt0aW1lb3V0OiA1MDB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBlcnIgPSBlO1xuICAgIH1cbiAgICBzaG91bGQuZXhpc3QoZXJyKTtcbiAgICBlcnIubWVzc2FnZS5zaG91bGQuY29udGFpbihcInRpbWVkIG91dFwiKTtcbiAgICBlcnIubWVzc2FnZS5zaG91bGQuY29udGFpbihjbWQpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGFsbG93IGxhcmdlIGFtb3VudHMgb2Ygb3V0cHV0JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoZ2V0Rml4dHVyZShcImJpZ2J1ZmZlci5qc1wiKSk7XG4gICAgc3Rkb3V0Lmxlbmd0aC5zaG91bGQuYmUuYWJvdmUoNTEyICogMTAyNCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgaWdub3JlIG91dHB1dCBpZiByZXF1ZXN0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNtZCA9IGdldEZpeHR1cmUoXCJlY2hvLnNoXCIpO1xuICAgIGxldCBlY2hvMSA9IFwibXkgbmFtZSBpcyBib2JcIjtcbiAgICBsZXQge3N0ZG91dCwgY29kZX0gPSBhd2FpdCBleGVjKGNtZCwgW2VjaG8xXSwge2lnbm9yZU91dHB1dDogdHJ1ZX0pO1xuICAgIHN0ZG91dC5zaG91bGQuZXF1YWwoXCJcIik7XG4gICAgY29kZS5zaG91bGQuZXF1YWwoMCk7XG4gIH0pO1xufSk7XG5cbiJdfQ==